# koishi-plugin-asmrone

[![npm](https://img.shields.io/npm/v/koishi-plugin-asmrone?style=flat-square)](https://www.npmjs.com/package/koishi-plugin-asmrone)

利用 [asmr.one](https://asmr.one) 的 API，提供在聊天平台中搜索、查看并收听音声作品的功能。

**注意：部分内容可能不适合在所有场合使用 (NSFW)，请在合适的范围内使用本插件。**

## 功能

- **结果展示**: 支持两种模式展示搜索结果和作品详情：
    - **图片菜单**: (需 `puppeteer`) 将内容渲染为图片发送，可规避平台风控。
    - **文本消息**: 以纯文本或合并转发的形式发送。
- **音轨获取**: 支持三种方式发送音轨：
    - **`card`**: 音乐卡片 (仅部分平台和适配器支持，如 OneBot)。
    - **`file`**: 逐个发送原始音频文件。
    - **`zip`**: 将多个音轨打包为 ZIP 压缩包发送，支持加密。
- **交互式操作**:
    - 列表类指令支持回复【序号】选择项目。
    - 支持回复【f】进行翻页。
    - 支持回复【n/取消】随时中断当前操作。
- **权限管理**: 支持白名单和黑名单模式，可控制插件在不同群聊的可用性。

## 指令说明

### `搜音声 <关键词> [页数]`

搜索音声作品。

- **关键词**: 如果想使用多个标签进行搜索，请用 `/` 分割。
- **示例**: `搜音声 催眠/JK 2`

---

### `热门音声 [页数]`

获取当前热门作品列表。

- **示例**: `热门音声`

---

### `听音声 <RJ号> [音轨序号...] [选项]`

获取作品信息并发送音轨。

- **`RJ号`**: 支持 `RJ01234567` 或 `123456` 等格式，会自动补全。
- **`音轨序号` (可选)**: 一个或多个数字序号，用空格分隔。
    - 如果提供，则直接获取指定音轨。
    - 如果省略，则返回作品详情并等待用户回复序号。
- **`选项` (可选)**: `card` | `file` | `zip`。
    - 指定本次发送的音轨格式。
    - 如果省略，则使用配置中的默认发送方式。

#### **使用示例**

1.  **获取详情并等待交互**:
    ```
    听音声 RJ01234567
    ```
    > 机器人将回复作品信息，并等待输入音轨序号。

2.  **直接获取单个音轨 (指定 card 模式)**:
    ```
    听音声 RJ01234567 3 card
    ```

3.  **直接获取多个音轨 (指定 zip 模式)**:
    ```
    听音声 RJ01234567 1 3 5 zip
    ```

4.  **在交互中指定发送方式**:
    > 使用 `听音声 RJ01234567` 后，可通过回复 `2 4 zip` 来获取第 2 和第 4 轨，并以 ZIP 形式发送。

## 配置项

### 基础设置

| 配置项 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `apiBaseUrl` | `string` | `https://api.asmr-200.com/api` | 获取音声数据的 API 地址。 |
| `useForward` | `boolean` | `false` | (非图片菜单模式下) 是否使用合并转发发送长消息。 |
| `showSearchImage` | `boolean` | `false` | (非图片菜单模式下) 是否在搜索结果中显示封面图。 |
| `useImageMenu` | `boolean` | `true` | 是否启用图片菜单模式。需要 `koishi-plugin-puppeteer`。 |
| `showLinks` | `boolean` | `false` | 是否在作品详情中返回 asmr.one 和 DLsite 的链接。 |
| `pageSize` | `number` | `10` | 每页展示的结果数量 (范围 1-40)。 |

### 权限设置

| 配置项 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `accessMode` | `string` | `all` | 访问权限模式: `all` (所有), `whitelist` (白名单), `blacklist` (黑名单)。 |
| `whitelist` | `string[]` | `[]` | 白名单列表 (群号或频道 ID)。 |
| `blacklist` | `string[]` | `[]` | 黑名单列表 (群号或频道 ID)。 |

### 下载与发送设置

| 配置项 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `defaultSendMode` | `string` | `file` | `听音声` 指令的默认发送方式: `card`, `file`, `zip`。 |
| `downloadTimeout` | `number` | `300` | 单个音轨下载的超时时间 (秒)。 |

### 压缩包设置
*以下设置对所有 `zip` 模式的发送生效。*

| 配置项 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `zipMode` | `string` | `single` | 多音轨压缩方式: `single` (合并为一包) 或 `multiple` (每轨一包)。 |
| `usePassword` | `boolean` | `false` | 是否为压缩包添加密码。 |
| `password` | `string` | `""` | 压缩包的密码 (需先启用 `usePassword`)。 |

## 安装

可从 Koishi 插件市场搜索 `asmrone` 安装。

为使用图片菜单功能，需要同时安装 `koishi-plugin-puppeteer`。