# koishi-plugin-asmrone

[![npm](https://img-shields.io/npm/v/koishi-plugin-asmrone?style=flat-square)](https://www.npmjs.com/package/koishi-plugin-asmrone)

利用 [asmr.one](https://asmr.one) 的API，提供在聊天平台中搜索、查看并收听音声作品的功能。

**注意：部分内容可能不适合在所有场合使用 (NSFW)，请在合适的范围内使用本插件。**

## 🧩 前置依赖

- **Puppeteer (`koishi-plugin-puppeteer`)**: 启用插件的 **图片菜单** 功能需要安装并启用此插件。

## ✨ 功能特性

- **两种展示模式**：可以根据偏好和平台兼容性，在 **图片菜单** 和 **文本/合并转发** 模式之间自由切换。
- **美观图片菜单**：(需 `puppeteer`) 启用后，搜索结果和作品详情都将通过 Puppeteer 渲染成图片。提升视觉体验，并且一定程度上规避平台风控。
- **灵活收听方式**：可以按需选择合适方式收听音声：
    - **音乐卡片 (`card`)**: 在支持的平台（如 OneBot）上以原生音乐卡片形式发送。
    - **音频文件 (`file`)**: 逐个发送独立的音频文件。
    - **压缩包 (`zip`)**: 将多个音轨打包成 ZIP 文件发送，支持加密和两种打包模式（单包/多包）。
- **良好交互体验**：
    - 在图片菜单模式下，可以通过回复【序号】直接从搜索结果跳转到作品详情，或选择要收听的音轨。
    - 在文本模式下，插件可以利用合并转发（可在配置中开关）来收纳长消息，避免刷屏。
- **详尽信息展示**：无论是图片菜单还是文本模式，插件都会完整展示作品的封面、标题、社团、声优、评分、销量、发售日期、标签，以及每个音轨的**时长**和**文件大小**，信息一目了然。
- **精细权限管理**：支持 **白名单** 和 **黑名单** 模式，可以精确控制插件在不同群聊或频道中的可用性。

## 📖 指令说明

### `搜音声 <关键词> [页数]`

根据关键词搜索音声作品。

- **示例 1**: `搜音声 藤田茜`
- **示例 2 (多标签)**: `搜音声 催眠/舔耳 2`
- **交互**: 若启用了图片菜单，发送结果后可直接回复【序号】查看对应作品的详情。

---

### `听音声 <RJ号> [音轨序号...] [选项]`

获取指定 RJ 号作品的信息，并以指定方式发送音轨。

- **音轨序号 (可选)**:
  - 可以提供一个或多个数字序号（用空格分隔）。
  - 若省略，插件将返回作品详情和音轨列表，并等待回复序号进行下一步操作。
- **选项 (可选)**:
  - `card`: 以音乐卡片形式发送。
  - `file`: 逐个发送音频文件。
  - `zip`: 打包成 ZIP 压缩包发送。
  - 若省略，将使用插件配置中的 **默认发送方式**。

#### 示例

1.  **获取详情并等待交互 (使用默认发送方式):**
    ```
    听音声 RJ0123456
    ```
    > 机器人将回复作品信息图或文本，并等待输入音轨序号。

2.  **直接获取单个音轨，并指定以音乐卡片发送:**
    ```
    听音声 RJ0123456 3 card
    ```

3.  **直接获取多个音轨，并指定打包成 ZIP 文件:**
    ```
    听音声 RJ0123456 1 3 5 zip
    ```

4.  **在交互中指定发送方式:**
    > 当使用 `听音声 RJ0123456` 后，机器人会请求输入序号。此时可以回复：
    > `2 4 zip` (获取第 2 和第 4 轨，并以 ZIP 形式发送)

## ⚙️ 配置说明

在 Koishi 的插件配置页面中找到本插件的设置。

### 基础设置

| 配置项 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `useForward` | `boolean` | `true` | (非图片菜单模式下) 是否使用合并转发来发送长消息。 |
| `showSearchImage` | `boolean` | `true` | (非图片菜单模式下) 是否在搜索结果中显示封面图。**警告**：可能增加风控风险。 |
| `useImageMenu` | `boolean` | `true` | **(推荐)** 是否启用图片菜单模式。需要 `koishi-plugin-puppeteer`。 |

### 权限设置

| 配置项 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `accessMode` | `string` | `'all'` | 访问权限模式。可选 `all` (所有), `whitelist` (白名单), `blacklist` (黑名单)。 |
| `whitelist` | `string[]` | `[]` | 白名单列表。请填入群号或频道 ID。 |
| `blacklist` | `string[]` | `[]` | 黑名单列表。请填入群号或频道 ID。 |

### 下载与发送设置

| 配置项 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `defaultSendMode` | `string` | `'file'` | **默认发送方式**。在 `听音声` 指令未指定选项时生效。可选 `card`, `file`, `zip`。 |

### 压缩包默认设置 (全局)

设置对所有 `zip` 模式的发送都生效，无论是默认的还是由指令指定的。

| 配置项 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `zipMode` | `string` | `'single'` | 多音轨压缩方式。`single` (合并为一包) 或 `multiple` (每轨一包)。 |
| `usePassword` | `boolean` | `false` | 是否为压缩包添加密码。 |
| `password` | `string` | `'0721'` | 压缩包的密码 (需先勾选 `usePassword`)。 |

## 📦 安装

请在 Koishi 插件市场搜索 `asmrone` 并安装。为获得完整体验，建议同时安装 `koishi-plugin-puppeteer`。